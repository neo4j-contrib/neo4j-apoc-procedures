<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>APOC User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>APOC User Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#__apoc_name_history">"APOC" Name history</a></li>
<li><a href="#_download_latest_release_for_the_regular_user">Download latest release (for the regular user)</a></li>
<li><a href="#_build_install_the_current_development_branch_from_source">Build &amp; install the current development branch from source</a></li>
<li><a href="#_calling_procedures_within_cypher">Calling Procedures within Cypher</a></li>
</ul>
</li>
<li><a href="#_help_and_usage">Help and Usage</a></li>
<li><a href="#_overview_of_apoc_procedures">Overview of APOC Procedures</a>
<ul class="sectlevel2">
<li><a href="#_manual_indexes">Manual Indexes</a>
<ul class="sectlevel3">
<li><a href="#_index_queries">Index Queries</a></li>
<li><a href="#_index_management">Index Management</a></li>
<li><a href="#_schema_index_queries">Schema Index Queries</a></li>
</ul>
</li>
<li><a href="#_meta_graph">Meta Graph</a></li>
<li><a href="#_schema">Schema</a></li>
<li><a href="#_locking">Locking</a></li>
<li><a href="#_from_tojson">from/toJson</a></li>
<li><a href="#_export_import">Export / Import</a>
<ul class="sectlevel3">
<li><a href="#_export_to_cypher_script">Export to Cypher Script</a></li>
<li><a href="#_graphml_import_export">GraphML Import / Export</a></li>
</ul>
</li>
<li><a href="#_loading_data_from_rdbms">Loading Data from RDBMS</a></li>
<li><a href="#_loading_data_from_web_apis_json_xml_csv">Loading Data from Web-APIs (JSON, XML, CSV)</a></li>
<li><a href="#_interacting_with_elastic_search">Interacting with Elastic Search</a></li>
<li><a href="#_interacting_with_mongodb">Interacting with MongoDB</a></li>
<li><a href="#_streaming_data_to_gephi">Streaming Data to Gephi</a>
<ul class="sectlevel3">
<li><a href="#_notes">Notes</a></li>
<li><a href="#_example">Example</a></li>
</ul>
</li>
<li><a href="#_creating_data">Creating Data</a></li>
<li><a href="#_virtual_nodes_rels">Virtual Nodes/Rels</a></li>
<li><a href="#_virtual_graph">Virtual Graph</a></li>
<li><a href="#_generating_graphs">Generating Graphs</a></li>
<li><a href="#_warmup">Warmup</a></li>
<li><a href="#_monitoring">Monitoring</a></li>
<li><a href="#_cypher_execution">Cypher Execution</a></li>
<li><a href="#_job_management">Job Management</a></li>
<li><a href="#_graph_refactoring">Graph Refactoring</a></li>
<li><a href="#_spatial">Spatial</a></li>
<li><a href="#_helpers">Helpers</a>
<ul class="sectlevel3">
<li><a href="#_static_value_storage">Static Value Storage</a></li>
<li><a href="#_conversion_functions">Conversion Functions</a></li>
<li><a href="#_map_functions">Map Functions</a></li>
<li><a href="#_collection_functions">Collection Functions</a></li>
<li><a href="#_lookup_functions">Lookup Functions</a></li>
<li><a href="#_phonetic_comparisons">Phonetic Comparisons</a></li>
</ul>
</li>
<li><a href="#_date_time_support">Date/time Support</a>
<ul class="sectlevel3">
<li><a href="#_conversion_between_formatted_dates_and_timestamps">Conversion between formatted dates and timestamps</a></li>
<li><a href="#_reading_separate_datetime_fields">Reading separate datetime fields</a></li>
</ul>
</li>
<li><a href="#_bitwise_operations">Bitwise operations</a></li>
<li><a href="#_path_expander">Path Expander</a>
<ul class="sectlevel3">
<li><a href="#_relationship_filter">Relationship Filter</a></li>
<li><a href="#_label_filter">Label Filter</a></li>
</ul>
</li>
<li><a href="#_parallel_node_search">Parallel Node Search</a></li>
<li><a href="#_graph_algorithms_work_in_progress">Graph Algorithms (work in progress)</a></li>
</ul>
</li>
<li><a href="#_text_and_lookup_indexes">Text and Lookup Indexes</a>
<ul class="sectlevel2">
<li><a href="#_index_queries_2">Index Queries</a></li>
<li><a href="#_index_management_2">Index Management</a></li>
<li><a href="#_full_text_search">Full Text Search</a>
<ul class="sectlevel3">
<li><a href="#_advanced_search">Advanced Search</a></li>
<li><a href="#_fulltext_and_graph_search">Fulltext and Graph Search</a></li>
<li><a href="#_complex_searches">Complex Searches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_utility_functions">Utility Functions</a>
<ul class="sectlevel2">
<li><a href="#_phonetic_text_procedures">Phonetic Text Procedures</a></li>
<li><a href="#_extract_domain">Extract Domain</a>
<ul class="sectlevel3">
<li><a href="#_timetolive_ttl_expire_nodes">TimeToLive (TTL) - Expire Nodes</a></li>
</ul>
</li>
<li><a href="#_date_and_time_conversions">Date and Time Conversions</a>
<ul class="sectlevel3">
<li><a href="#_conversion_between_formatted_dates_and_timestamps_2">Conversion between formatted dates and timestamps</a></li>
<li><a href="#_reading_separate_datetime_fields_2">Reading separate datetime fields:</a></li>
<li><a href="#_examples">Examples</a></li>
<li><a href="#_notes_on_formats">Notes on formats:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_graph_algorithms">Graph Algorithms</a>
<ul class="sectlevel2">
<li><a href="#_expand_paths">Expand paths</a>
<ul class="sectlevel3">
<li><a href="#_usage">Usage</a></li>
<li><a href="#_examples_2">Examples</a></li>
<li><a href="#_expand_with_config">Expand with Config</a></li>
</ul>
</li>
<li><a href="#_centrality_algorithms">Centrality Algorithms</a>
<ul class="sectlevel3">
<li><a href="#_setup">Setup</a></li>
<li><a href="#_closeness_centrality_procedure">Closeness Centrality Procedure</a></li>
<li><a href="#_betweenness_centrality_procedure">Betweenness Centrality Procedure</a></li>
</ul>
</li>
<li><a href="#_pagerank_algorithm">PageRank Algorithm</a>
<ul class="sectlevel3">
<li><a href="#_setup_2">Setup</a></li>
<li><a href="#_pagerank_procedure">PageRank Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spatial_2">Spatial</a>
<ul class="sectlevel2">
<li><a href="#_spatial_functions">Spatial Functions</a>
<ul class="sectlevel3">
<li><a href="#_geocode">geocode</a></li>
<li><a href="#_configuring_geocode">Configuring Geocode</a></li>
<li><a href="#_configuring_custom_geocode_provider">Configuring Custom Geocode Provider</a></li>
<li><a href="#_using_geocode_within_a_bigger_cypher_query">Using Geocode within a bigger Cypher query</a></li>
<li><a href="#_calculating_distance_between_locations">Calculating distance between locations</a></li>
<li><a href="#_graph_refactoring_2">Graph Refactoring</a></li>
<li><a href="#_combined_space_and_time_search">Combined Space and Time search</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_data_integration">Data Integration</a>
<ul class="sectlevel2">
<li><a href="#_load_json">Load JSON</a>
<ul class="sectlevel3">
<li><a href="#_load_json_with_additional_parameters">Load Json with additional parameters</a></li>
<li><a href="#_load_json_stackoverflow_example">Load JSON StackOverflow Example</a></li>
</ul>
</li>
<li><a href="#_load_jdbc">Load JDBC</a>
<ul class="sectlevel3">
<li><a href="#_mysql_example">MySQL Example</a></li>
<li><a href="#_load_jdbc_examples">Load JDBC Examples</a></li>
<li><a href="#_cassandra_example">Cassandra Example</a></li>
</ul>
</li>
<li><a href="#_streaming_data_to_gephi_2">Streaming Data to Gephi</a></li>
<li><a href="#_notes_2">Notes</a></li>
<li><a href="#_example_2">Example</a>
<ul class="sectlevel3">
<li><a href="#_format">Format</a></li>
<li><a href="#_specifics_details">Specifics Details</a></li>
</ul>
</li>
<li><a href="#_elasticsearch_integration">ElasticSearch Integration</a>
<ul class="sectlevel3">
<li><a href="#_example_3">Example</a></li>
<li><a href="#_general_structure_and_parameters">General Structure and Parameters</a></li>
</ul>
</li>
<li><a href="#_load_xml">Load XML</a>
<ul class="sectlevel3">
<li><a href="#_example_how_do_you_access_xml_doc_attributes_in_children_fields">Example: How do you access xml doc attributes in children fields ?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_graph_refactorings">Graph Refactorings</a>
<ul class="sectlevel2">
<li><a href="#_graph_refactoring_procedures">Graph Refactoring Procedures</a>
<ul class="sectlevel3">
<li><a href="#_normalize_boolean_properties">Normalize boolean properties</a></li>
<li><a href="#_categorization">Categorization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cypher_operations">Cypher Operations</a>
<ul class="sectlevel2">
<li><a href="#_running_cypher_fragments">Running Cypher fragments</a>
<ul class="sectlevel3">
<li><a href="#_cypher_execution_2">Cypher Execution</a></li>
<li><a href="#_example_fast_node_counts_by_label">Example: Fast Node-Counts by Label</a></li>
<li><a href="#_running_a_cypher_statement_timeboxed">running a cypher statement timeboxed</a></li>
</ul>
</li>
<li><a href="#_job_management_and_periodic_execution">Job management and periodic execution</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="imageblock" style="float: right">
<div class="content">
<img src="https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/docs/img/apoc.gif" alt="apoc">
</div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p>Apache License 2.0</p>
</div>
</div>
<div class="sect2">
<h3 id="__apoc_name_history">"APOC" Name history</h3>
<div class="paragraph">
<p><a href="http://matrix.wikia.com/wiki/Apoc">Apoc</a> was the technician and driver on board of the Nebuchadnezzar in the Matrix movie. He was killed by Cypher.</p>
</div>
<div class="paragraph">
<p><strong>APOC</strong> was also the first bundled <a href="http://neo4j.com/blog/convenient-package-neo4j-apoc-0-1-released/">A Package Of Components</a> for Neo4j in 2009.</p>
</div>
<div class="paragraph">
<p><strong>APOC</strong> also stands for "Awesome Procedures On Cypher"</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_latest_release_for_the_regular_user">Download latest release (for the regular user)</h3>
<div class="paragraph">
<p>Go to <a href="http://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/latest" class="bare">http://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/latest</a>
to find the latest release and download the binary jar to place into your $NEO4J_HOME/plugins folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_build_install_the_current_development_branch_from_source">Build &amp; install the current development branch from source</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">git clone http://github.com/neo4j-contrib/neo4j-apoc-procedures
./gradlew shadow
cp build/libs/apoc-&lt;version&gt;-SNAPSHOT-all.jar $NEO4J_HOME/plugins/
$NEO4J_HOME/bin/neo4j restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>A full build including running the tests can be run by <code>./gradlew build</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_procedures_within_cypher">Calling Procedures within Cypher</h3>
<div class="paragraph">
<p>Procedures can be called stand-alone with <code>CALL procedure.name();</code></p>
</div>
<div class="paragraph">
<p>But you can also integrate them into your Cypher statements which makes them so much more powerful.</p>
</div>
<div class="listingblock">
<div class="title">Load JSON example</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH 'https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/person.json' AS url

CALL apoc.load.json(url) YIELD value as person

MERGE (p:Person {name:person.name})
   ON CREATE SET p.age = person.age, p.children = size(person.children)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_help_and_usage">Help and Usage</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc-help-apoc.jpg" alt="apoc help apoc" width="600">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.help('search')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lists name, description-text and if the procedure performs writes (descriptions are WIP), search string is checked against beginning (package) or end (name) of procedure</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">helpful</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.help("apoc") YIELD name, text
WITH * WHERE text IS null
RETURN name AS undocumented</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate the help from <code>@Description</code> annotations, apoc currently scans the jar file with ASM.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_apoc_procedures">Overview of APOC Procedures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_manual_indexes">Manual Indexes</h3>
<div class="sect3">
<h4 id="_index_queries">Index Queries</h4>
<div class="paragraph">
<p>Procedures to add to and query manual indexes</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please note that there are (case-sensitive) <a href="http://neo4j.com/docs/developer-manual/current/#cypher-schema">automatic schema indexes</a>, for equality, non-equality, existence, range queries, starts with, ends-with and contains!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addAllNodes('index-name',{label1:['prop1',&#8230;&#8203;],&#8230;&#8203;})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add all nodes to this full text index with the given fields, additionally populates a 'search' index field with all of them in one place</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addNode(node,['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add node to an index for each label it has</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addNodeByLabel(node,'Label',['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add node to an index for the given label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addRelationship(rel,['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add relationship to an index for its type</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.index.nodes-with-score.jpg" alt="apoc.index.nodes with score" width="600">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.search('index-name', 'query') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search for the first 100 nodes in the given full text index matching the given lucene query returned by relevance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.nodes('Label','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on node index with the given label name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.relationships('TYPE','prop:value*') YIELD rel, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.between(node1,'TYPE',node2,'prop:value*') YIELD rel, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name bound by either or both sides (each node parameter can be null)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.out(node,'TYPE','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name for <strong>outgoing</strong> relationship of the given node, <strong>returns end-nodes</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.in(node,'TYPE','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name for <strong>incoming</strong> relationship of the given node, <strong>returns start-nodes</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_index_management">Index Management</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.list() YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lists all manual indexes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.remove('name') YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removes manual indexes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.forNodes('name',{config}) YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gets or creates manual node index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.forRelationships('name',{config}) YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gets or creates manual relationship index</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Add node to index example</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">match (p:Person) call apoc.index.addNode(p,["name","age"]) RETURN count(*);
// 129s for 1M People
call apoc.index.nodes('Person','name:name100*') YIELD node, weight return * limit 2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_schema_index_queries">Schema Index Queries</h4>
<div class="paragraph">
<p>Schema Index lookups that keep order and can apply limits</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.orderedRange(label,key,min,max,sort-relevance,limit) yield node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema range scan which keeps index order and adds limit, values can be null, boundaries are inclusive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.orderedByText(label,key,operator,value,sort-relevance,limit) yield node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema string search which keeps index order and adds limit, operator is 'STARTS WITH' or 'CONTAINS'</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_meta_graph">Meta Graph</h3>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.meta.graph.jpg" alt="apoc.meta.graph" width="600">
</div>
</div>
<div class="paragraph">
<p>Returns a virtual graph that represents the labels and relationship-types available in your database and how they are connected.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.graph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">examines the full graph to create the meta-graph</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.graphSample(sampleSize)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">examines a sample graph to create the meta-graph, default sampleSize is 100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.subGraph({config})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">examines a sample sub graph to create the meta-graph, default sampleSize is 100<br>
config is: {labels:[labels],rels:[rel-types],sample:sample}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">examines a subset of the graph to provide a tabular meta information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.stats  yield labelCount, relTypeCount, propertyKeyCount, nodeCount, relCount, labels, relTypes, stats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the information stored in the transactional database statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.type(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type name of a value (<code>INTEGER,FLOAT,STRING,BOOLEAN,RELATIONSHIP,NODE,PATH,NULL,UNKNOWN,MAP,LIST</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.meta.isType(value,type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a row if type name matches none if not</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">isType example</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n:Person)
CALL apoc.meta.isType(n.age,"INTEGER")
RETURN n LIMIT 5</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_schema">Schema</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.schema.assert({indexLabel:[indexKeys],&#8230;&#8203;},{constraintLabel:[constraintKeys,&#8230;&#8203;]}) yield label, key, unique, action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asserts that at the end of the operation the given indexes and unique constraints are there, each label:key pair is considered one constraint/label</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_locking">Locking</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.lock.nodes([nodes])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acquires a write lock on the given nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.lock.rels([relationships])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acquires a write lock on the given relationship</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.lock.all([nodes],[relationships])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acquires a write lock on the given nodes and relationships</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_from_tojson">from/toJson</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.convert.toJson([1,2,3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts value to json string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.convert.toJson( {a:42,b:"foo",c:[1,2,3]})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts value to json map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.convert.fromJsonList('[1,2,3]')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts json list to Cypher list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.convert.fromJsonMap( '{"a":42,"b":"foo","c":[1,2,3]}')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts json map to Cypher map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.convert.toTree([paths]) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a stream of nested documents representing the at least one root of these paths</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_export_import">Export / Import</h3>
<div class="paragraph">
<p>Data is exported as cypher statements (for neo4j-shell, and partly apoc.cypher.runFile to the given file.</p>
</div>
<div class="sect3">
<h4 id="_export_to_cypher_script">Export to Cypher Script</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.cypher.all(file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports whole database incl. indexes as cypher statements to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.cypher.data(nodes,rels,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports given nodes and relationships incl. indexes as cypher statements to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.cypher.graph(graph,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports given graph object incl. indexes as cypher statements to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.cypher.query(query,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports nodes and relationships from the cypher statement incl. indexes as cypher statements to the provided file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_graphml_import_export">GraphML Import / Export</h4>
<div class="paragraph">
<p>GraphML is used by other tools, like Gephi and CytoScape to read graph data.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.import.graphml(file-or-url,{batchSize: 10000, readLabels: true, storeNodeIds: false, defaultRelationshipType:"RELATED"})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imports graphml into the graph</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.graphml.all(file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports whole database as graphml to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.graphml.data(nodes,rels,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports given nodes and relationships as graphml to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.graphml.graph(graph,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports given graph object as graphml to the provided file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.export.graphml.query(query,file,config)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exports nodes and relationships from the cypher statement as graphml to the provided file</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_loading_data_from_rdbms">Loading Data from RDBMS</h3>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc-jdbc-northwind-load.jpg" alt="apoc jdbc northwind load" width="600">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.jdbc('jdbc:derby:derbyDB','PERSON') YIELD row CREATE (:Person {name:row.name})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from relational database, either a full table or a sql statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.jdbc('jdbc:derby:derbyDB','SELECT * FROM PERSON WHERE AGE &gt; 18')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from relational database, either a full table or a sql statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.driver('org.apache.derby.jdbc.EmbeddedDriver')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register JDBC driver of source database</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To simplify the JDBC URL syntax, for example 'jdbc:derby:derbyDB', and so as to mask the details one can define in conf/neo4j.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apoc.jdbc.derby.url=jdbc:derby:derbyDB</pre>
</div>
</div>
<div class="paragraph">
<p>and then</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CALL apoc.load.jdbc('jdbc:derby:derbyDB','PERSON') YIELD row CREATE (:Person {name:row.name})</pre>
</div>
</div>
<div class="paragraph">
<p>becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CALL apoc.load.jdbc('derby','PERSON') YIELD row CREATE (:Person {name:row.name})</pre>
</div>
</div>
<div class="paragraph">
<p>The 3rd value in the 'apoc.jdbc.derby.url=' effectively defines an &lt;alias&gt; to be used in the apoc.load.jdbc('&lt;alias&gt;',&#8230;&#8203;.</p>
</div>
</div>
<div class="sect2">
<h3 id="_loading_data_from_web_apis_json_xml_csv">Loading Data from Web-APIs (JSON, XML, CSV)</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.json('http://example.com/map.json') YIELD value as person CREATE (p:Person) SET p = person</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from JSON URL (e.g. web-api) to import JSON as stream of values if the JSON was an array or a single value if it was a map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.xml('http://example.com/test.xml') YIELD value as doc CREATE (p:Person) SET p.name = doc.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from XML URL (e.g. web-api) to import XML as single nested map with attributes and <code>_type</code>, <code>_text</code> and <code>_children</code> fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.xmlSimple('http://example.com/test.xml') YIELD value as doc CREATE (p:Person) SET p.name = doc.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from XML URL (e.g. web-api) to import XML as single nested map with attributes and <code><em>type</code>, <code>_text</code> fields and <code></em>&lt;childtype&gt;</code> collections per child-element-type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.csv('url',{sep:";"}) YIELD lineNo, list, map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load CSV fom URL as stream of values<br>
config contains any of: <code>{skip:1,limit:5,header:false,sep:'TAB',ignore:['tmp'],arraySep:';',mapping:{years:{type:'int',arraySep:'-',array:false,name:'age',ignore:false}}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_interacting_with_elastic_search">Interacting with Elastic Search</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.stats(host-url-Key)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elastic search statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.get(host-or-port,index-or-null,type-or-null,id-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a GET operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.query(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a SEARCH operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.getRaw(host-or-port,path,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a raw GET operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.postRaw(host-or-port,path,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a raw POST operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.post(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a POST operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.put(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a PUT operation</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_interacting_with_mongodb">Interacting with MongoDB</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.get(host-or-port,db-or-null,collection-or-null,query-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a find operation on mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.count(host-or-port,db-or-null,collection-or-null,query-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a find operation on mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.first(host-or-port,db-or-null,collection-or-null,query-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a first operation on mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.find(host-or-port,db-or-null,collection-or-null,query-or-null,projection-or-null,sort-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a find,project,sort operation on mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.insert(host-or-port,db-or-null,collection-or-null,list-of-maps)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inserts the given documents into the mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.delete(host-or-port,db-or-null,collection-or-null,list-of-maps)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inserts the given documents into the mongodb collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.mongodb.update(host-or-port,db-or-null,collection-or-null,list-of-maps)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inserts the given documents into the mongodb collection</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Copy these jars into the plugins directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn dependency:copy-dependencies
cp target/dependency/mongodb*.jar target/dependency/bson*.jar $NEO4J_HOME/plugins/</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.mongodb.first('mongodb://localhost:27017','test','test',{name:'testDocument'})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_data_to_gephi">Streaming Data to Gephi</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.gephi.add(url-or-key, workspace, data)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams provided data to Gephi</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_notes">Notes</h4>
<div class="paragraph">
<p>Gephi has a <a href="https://marketplace.gephi.org/plugin/graph-streaming/">streaming plugin</a>, that can provide and accept <a href="https://github.com/gephi/gephi/wiki/GraphStreaming#Gephi_as_Master">JSON-graph-data</a> in a streaming fashion.</p>
</div>
<div class="paragraph">
<p>Make sure to install the plugin firsrt and activate it for your workspace (there is a new "Streaming"-tab besides "Layout"), right-click "Master"&#8594;"start" to start the server.</p>
</div>
<div class="paragraph">
<p>You can provide your workspace name (you might want to rename it before you start thes streaming), otherwise it defaults to <code>workspace0</code></p>
</div>
<div class="paragraph">
<p>The default Gephi-URL is <a href="http://localhost:8080" class="bare">http://localhost:8080</a>, resulting in <code><a href="http://localhost:8080/workspace0?operation=updateGraph" class="bare">http://localhost:8080/workspace0?operation=updateGraph</a></code></p>
</div>
<div class="paragraph">
<p>You can also configure it in <code>conf/neo4j.conf</code> via  <code>apoc.gephi.url=url</code> or <code>apoc.gephi.&lt;key&gt;.url=url</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_example">Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">match path = (:Person)-[:ACTED_IN]-&gt;(:Movie)
WITH path LIMIT 1000
with collect(path) as paths
call apoc.gephi.add(null,'workspace0', paths) yield nodes, relationships, time
return nodes, relationships, time</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_data">Creating Data</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.node(['Label'], {key:value,&#8230;&#8203;})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create node with dynamic labels</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.nodes(['Label'], [{key:value,&#8230;&#8203;}])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create multiple nodes with dynamic labels</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.addLabels( [node,id,ids,nodes], ['Label',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adds the given labels to the node or nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.removeLabels( [node,id,ids,nodes], ['Label',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removes the given labels from the node or nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.relationship(person1,'KNOWS',{key:value,&#8230;&#8203;}, person2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create relationship with dynamic rel-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.uuid YIELD uuid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates an UUID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.uuids(count) YIELD uuid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates count UUIDs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.nodes.link([nodes],'REL_TYPE')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a linked list of nodes from first to last</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_virtual_nodes_rels">Virtual Nodes/Rels</h3>
<div class="paragraph">
<p>Virtual Nodes and Relationships don&#8217;t exist in the graph, they are only returned to the UI/user for representing a graph projection.
They can be visualized or processed otherwise.
Please note that they have negative id&#8217;s.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.vNode(['Label'], {key:value,&#8230;&#8203;})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a virtual node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.vNodes(['Label'], [{key:value,&#8230;&#8203;}])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns virtual nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.vRelationship(nodeFrom,'KNOWS',{key:value,&#8230;&#8203;}, nodeTo)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a virtual relationship</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.vPattern({_labels:['LabelA'],key:value},'KNOWS',{key:value,&#8230;&#8203;}, {_labels:['LabelB'],key:value})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a virtual pattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.create.vPatternFull(['LabelA'],{key:value},'KNOWS',{key:value,&#8230;&#8203;},['LabelB'],{key:value})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a virtual pattern</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a)-[r]-&gt;(b)
WITH head(labels(a)) AS l, head(labels(b)) AS l2, type(r) AS rel_type, count(*) as count
CALL apoc.create.vNode(['Meta_Node'],{name:l}) yield node as a
CALL apoc.create.vNode(['Meta_Node'],{name:l2}) yield node as b
CALL apoc.create.vRelationship(a,'META_RELATIONSHIP',{name:rel_type, count:count},b) yield rel
RETURN *;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_graph">Virtual Graph</h3>
<div class="paragraph">
<p>Create a graph object (map) from information that&#8217;s passed in.
It&#8217;s basic structure is: <code>{name:"Name",properties:{properties},nodes:[nodes],relationships:[relationships]}</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.from(data,'name',{properties}) yield graph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing it tries its best to extract the graph information from the data you pass in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.fromData([nodes],[relationships],'name',{properties})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.fromPaths(path,'name',{properties})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.fromPaths([paths],'name',{properties})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.fromDB('name',{properties})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.graph.fromCypher('statement',{params},'name',{properties})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a virtual graph object for later processing</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_generating_graphs">Generating Graphs</h3>
<div class="paragraph">
<p>Generate undirected (random direction) graphs with semi-real random distributions based on theoretical models.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.generate.er(noNodes, noEdges, 'label', 'type')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generates a graph according to Erdos-Renyi model (uniform)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.generate.ws(noNodes, degree, beta, 'label', 'type')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generates a graph according to Watts-Strogatz model (clusters)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.generate.ba(noNodes, edgesPerNode, 'label', 'type')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generates a graph according to Barabasi-Albert model (preferential attachment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.generate.complete(noNodes, 'label', 'type')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generates a complete graph (all nodes connected to all other nodes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.generate.simple([degrees], 'label', 'type')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generates a graph with the given degree distribution</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.generate.ba(1000, 2, 'TestLabel', 'TEST_REL_TYPE')
CALL apoc.generate.ws(1000, null, null, null)
CALL apoc.generate.simple([2,2,2,2], null, null)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_warmup">Warmup</h3>
<div class="paragraph">
<p>(thanks @SaschaPeukert)</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.warmup.run()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warmup the node and relationship page-caches by loading one page at a time</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_monitoring">Monitoring</h3>
<div class="paragraph">
<p>(thanks @ikwattro)</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.monitor.ids</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node and relationships-ids in total and in use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.monitor.kernel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store information such as kernel version, start time, read-only, database-name, store-log-version etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.monitor.store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store size information for the different types of stores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.monitor.tx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of transactions total,opened,committed,concurrent,rolled-back,last-tx-id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.monitor.locks(minWaitTime long)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">db locking information such as avertedDeadLocks, lockCount, contendedLockCount and contendedLocks etc. (enterprise)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_cypher_execution">Cypher Execution</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.run(fragment, params) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes reading fragment with the given parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runFile(file or url) yield row, result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">runs each statement in the file, all semicolon separated - currently no schema operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runMany('cypher;\nstatements;',{params})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">runs each semicolon separated statement and returns summary - currently no schema operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.mapParallel(fragment, params, list-to-parallelize) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes fragment in parallel batches with the list segments being assigned to _</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.doIt(fragment, params) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes writing fragment with the given parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runTimeboxed('cypherStatement',{params}, timeout)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abort statement after timeout millis if not finished</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TODO runFile: begin/commit/schema await/constraints/indexes</p>
</div>
</div>
<div class="sect2">
<h3 id="_job_management">Job Management</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.commit(statement, params)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">repeats an batch update statement until it returns 0, this procedure is blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.list()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.submit('name',statement)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">submit a one-off background statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.schedule('name',statement,repeat-time-in-seconds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">submit a repeatedly-called background statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.countdown('name',statement,delay-in-seconds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">submit a repeatedly-called background statement until it returns 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.rock_n_roll(statementIteration, statementAction, batchSize) YIELD batches, total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iterate over first statement and apply action statement with given transaction batch size. Returns to numeric values holding the number of batches and the number of total processed rows. E.g.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.periodic.iterate('statement returning items', 'statement per item', {batchSize:1000,parallel:true}) YIELD batches, total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run the second statement for each item returned by the first statement. Returns number of batches and total processed rows</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>there are also static methods <code>Jobs.submit</code>, and <code>Jobs.schedule</code> to be used from other procedures</p>
</li>
<li>
<p>jobs list is checked / cleared every 10s for finished jobs</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.periodic.rock_n_roll('match (p:Person) return id(p) as id_p', 'MATCH (p) where id(p)={id_p} SET p.lastname =p.name', 20000)</code></pre>
</div>
</div>
<div class="paragraph">
<p>copies over the <code>name</code> property of each person to <code>lastname</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_graph_refactoring">Graph Refactoring</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.cloneNodes([node1,node2,&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clone nodes with their labels and properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.cloneNodesWithRelationships([node1,node2,&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clone nodes with their labels, properties and relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.mergeNodes([node1,node2])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">merge nodes onto first in list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.to(rel, endNode)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect relationship to use new end-node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.from(rel, startNode)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect relationship to use new start-node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.setType(rel, 'NEW-TYPE')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change relationship-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.extractNode([rel1,rel2,&#8230;&#8203;], [labels], 'OUT','IN')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extract node from relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.collapseNode([node1,node2],'TYPE')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collapse node to relationship, node with one rel becomes self-relationship</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.normalizeAsBoolean(entity, propertyKey, true_values, false_values)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">normalize/convert a property to be boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.refactor.categorize(node, propertyKey, type, outgoing, label)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">turn each unique propertyKey into a category node and connect to it</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TODO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge nodes by label + property</p>
</li>
<li>
<p>merge relationships</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_spatial">Spatial</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.spatial.geocode('address') YIELD location, latitude, longitude, description, osmData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">look up geographic location of location from openstreetmap geocoding service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.spatial.sortPathsByDistance(Collection&lt;Path&gt;) YIELD path, distance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort a given collection of paths by geographic distance based on lat/long properties on the path nodes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_helpers">Helpers</h3>
<div class="sect3">
<h4 id="_static_value_storage">Static Value Storage</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.static.get(name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns statically stored value from config (apoc.static.&lt;key&gt;) or server lifetime storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.static.getAll(prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns statically stored values from config (apoc.static.&lt;prefix&gt;) or server lifetime storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.static.set(name, value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stores value under key for server livetime storage, returns previously stored or configured value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_conversion_functions">Conversion Functions</h4>
<div class="paragraph">
<p>Sometimes type information gets lost, these functions help you to coerce an "Any" value to the concrete type</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toString(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toMap(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toList(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toBoolean(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toNode(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toRelationship(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a relationship</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.convert.toSet(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tries it&#8217;s best to convert the value to a set</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_map_functions">Map Functions</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.fromPairs([[key,value],[key2,value2],&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates map from list with key-value pairs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.fromLists([keys],[values])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates map from a keys and a values list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.fromValues([key,value,key1,value1])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates map from alternating keys and values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.setKey(map,key,value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the map with the value for this key added or replaced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.removeKey(map,key)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the map with the key removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.removeKeys(map,[keys])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the map with the keys removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.map.clean(map,[keys],[values]) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removes the keys and values (e.g. null-placeholders) contained in those lists, good for data cleaning from CSV/JSON</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_collection_functions">Collection Functions</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.sum([0.5,1,2.3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum of all values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.avg([0.5,1,2.3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">avg of all values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.min([0.5,1,2.3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum of all values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.max([0.5,1,2.3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum of all values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.sumLongs([1,3,3])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sums all numeric values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.partition(list,batchSize)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">partitions a list into sublists of <code>batchSize</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.zip([list1],[list2])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.pairs([1,2,3]) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,2],[2,3],[3,null]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.pairsMin([1,2,3]) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,2],[2,3]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.toSet([list])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns a unique list backed by a set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.sort(coll)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort on Collections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.sortNodes([nodes], 'name')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort nodes by property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.contains(coll, value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimized contains operation (using a HashSet) (returns single row or not)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.containsAll(coll, values)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimized contains-all operation (using a HashSet) (returns single row or not)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.containsSorted(coll, value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimized contains on a sorted list operation (Collections.binarySearch) (returns single row or not)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.containsAllSorted(coll, value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimized contains-all on a sorted list operation (Collections.binarySearch) (returns single row or not)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.union(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates the distinct union of the 2 lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.subtract(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns unique set of first list with all elements of second list removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.removeAll(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns first list with all elements of second list removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.intersection(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the unique intersection of the two lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.disjunction(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns the disjunct set of the two lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.unionAll(first, second)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates the full union with duplicates of the two lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.split(list,value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">splits collection on given values rows of lists, value itself will not be part of resulting lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.coll.indexOf(coll, value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">position of value in the list</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_lookup_functions">Lookup Functions</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.get.nodes(node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[ids]) yield node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quickly returns all nodes with these id&#8217;s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.get.rels(rels</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[ids]) yield rel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quickly returns all relationships with these id&#8217;s</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_phonetic_comparisons">Phonetic Comparisons</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.phonetic(value) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the US_ENGLISH phonetic soundex encoding of all words of the text value which can be a single string or a list of strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.phoneticDelta(text1, text2) yield phonetic1, phonetic2, delta</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the US_ENGLISH soundex character difference between two given strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.join(['text1','text2',&#8230;&#8203;], delimiter) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">join the given strings with the given delimiter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.clean(text) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strip the given string of everything except alpha numeric characters and convert it to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.compareCleaned(text1, text2) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compare the given strings stripped of everything except alpha numeric characters converted to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.text.filterCleanMatches(text1, text2) YIELD value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter out non-matches of the given strings stripped of everything except alpha numeric characters converted to lower case.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.data.domain(email_or_url) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns domain part of the value</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.util.sha1([values])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">computes the sha1 of the concatenation of all string values of the list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.util.md5([values])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">computes the md5 of the concatenation of all string values of the list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.util.sleep({duration})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sleeps for &lt;duration&gt; millis, transaction termination is honored</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_date_time_support">Date/time Support</h3>
<div class="paragraph">
<p>(thanks @tkroman)</p>
</div>
<div class="sect3">
<h4 id="_conversion_between_formatted_dates_and_timestamps">Conversion between formatted dates and timestamps</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.parseDefault('2015-03-25 03:15:59','s')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get Unix time equivalent of given date (in seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.parse('2015/03/25 03-15-59','s', 'yyyy/MM/dd HH/mm/ss')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as previous, but accepts custom datetime format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.formatDefault(12345,'s')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get string representation of date corresponding to given Unix time (in seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.format(12345,'s', 'yyyy/MM/dd HH/mm/ss')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the same as previous, but accepts custom datetime format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.parseDefault('2015-03-25 03:15:59','ms')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get Unix time equivalent of given date (in milliseconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.parse('2015/03/25 03-15-59','ms','yyyy/MM/dd HH/mm/ss')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as previous, but accepts custom datetime format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.formatDefault(12345,'ms')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get string representation of date corresponding to given time in milliseconds in UTC time zone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.format(12345,'ms', 'yyyy/MM/dd HH/mm/ss')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the same as previous, but accepts custom datetime format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.date.formatTimeZone(12345,'s', 'yyyy/MM/dd HH/mm/ss', 'ABC')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the same as previous, but accepts custom time zone</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>possible unit values: <code>ms,s,m,h,d</code> and their long forms <code>millis,milliseconds,seconds,minutes,hours,days</code>.</p>
</li>
<li>
<p>possible time zone values: Either an abbreviation such as <code>PST</code>, a full name such as <code>America/Los_Angeles</code>, or a custom ID such as <code>GMT-8:00</code>. Full names are recommended. You can view a list of full names in <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">this Wikipedia page</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reading_separate_datetime_fields">Reading separate datetime fields</h4>
<div class="paragraph">
<p>Splits date (optionally, using given custom format) into fields returning a map from field name to its value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apoc.date.fields('2015-03-25 03:15:59')</code></p>
</li>
<li>
<p><code>apoc.date.fieldsFormatted('2015-01-02 03:04:05 EET', 'yyyy-MM-dd HH:mm:ss zzz')</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bitwise_operations">Bitwise operations</h3>
<div class="paragraph">
<p>Provides a wrapper around the java bitwise operations.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(a long, "operation", b long ) yield value as &lt;identifier&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>examples</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">example</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a &amp; b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&amp;",13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a | b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"|",13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">61</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a ^ b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&amp;",13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">49</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&amp;",0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-61</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a &lt;&lt; b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LEFT SHIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&lt;&lt;",2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a &gt;&gt; b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RIGHT SHIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&gt;&gt;",2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a &gt;&gt;&gt; b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNSIGNED RIGHT SHIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call apoc.bitwise.op(60,"&gt;&gt;&gt;",2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_path_expander">Path Expander</h3>
<div class="paragraph">
<p>(thanks @keesvegter)</p>
</div>
<div class="paragraph">
<p>The apoc.path.expand procedure makes it possible to do variable length path traversals where you can specify the direction of the relationship per relationship type and a list of Label names which act as a "whitelist" or a "blacklist". The procedure will return a list of Paths in a variable name called "path".</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.path.expand(startNode &lt;id&gt;|Node, relationshipFilter, labelFilter, minDepth, maxDepth ) yield path as &lt;identifier&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expand from given nodes(s) taking the provided restrictions into account</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_relationship_filter">Relationship Filter</h4>
<div class="paragraph">
<p>Syntax: <code>[&lt;]RELATIONSHIP_TYPE1[&gt;]|[&lt;]RELATIONSHIP_TYPE2[&gt;]|&#8230;&#8203;</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">input</th>
<th class="tableblock halign-left valign-top">type</th>
<th class="tableblock halign-left valign-top">direction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKES&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKES</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>OUTGOING</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;FOLLOWS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FOLLOWS</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>INCOMING</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KNOWS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KNOWS</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>BOTH</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_label_filter">Label Filter</h4>
<div class="paragraph">
<p>Syntax: <code>[+-/]LABEL1|LABEL2|&#8230;&#8203;</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">input</th>
<th class="tableblock halign-left valign-top">label</th>
<th class="tableblock halign-left valign-top">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+Friend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Friend</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>include label (whitelist)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Foe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Foe</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>exclude label (blacklist)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Friend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Friend</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>stop traversal after reaching a friend (but include him)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_parallel_node_search">Parallel Node Search</h3>
<div class="paragraph">
<p>Utility to find nodes in parallel (if possible). These procedures return a single list of nodes or a list of 'reduced' records with node id, labels, and the properties where the search was executed upon.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 55%;">
<col style="width: 44%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.search.node(labelPropertyMap, searchType, search ) yield node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A distinct set of Nodes will be returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.search.nodeAll(labelPropertyMap, searchType, search ) yield node</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the found Nodes will be returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.search.nodeReduced(labelPropertyMap, searchType, search ) yield id, labels, values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A merged set of 'minimal' Node information will be returned. One record per node (-id).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>call apoc.search.nodeAllReduced(labelPropertyMap, searchType, search ) yield id, labels, values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the found 'minimal' Node information will be returned. One record per label and property.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12%;">
<col style="width: 50%;">
<col style="width: 37%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>labelPropertyMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'{ label1 : "propertyOne", label2 :["propOne","propTwo"] }'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(JSON or Map) For every Label-Property combination a search will be executed in parallel (if possible): Label1.propertyOne, label2.propOne and label2.propTwo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'exact' or 'contains' or 'starts with' or 'ends with'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case insensitive string search operators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&lt;", "&gt;", "=", "&lt;&gt;", "&#8656;", "&gt;=", "=~"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>search</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Keanu'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual search term (string, number, etc).</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">example</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.search.nodeAll('{Person: "name",Movie: ["title","tagline"]}','contains','her') YIELD node AS n RETURN n
call apoc.search.nodeReduced({Person: 'born', Movie: ['released']},'&gt;',2000) yield id, labels, properties RETURN *</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graph_algorithms_work_in_progress">Graph Algorithms (work in progress)</h3>
<div class="paragraph">
<p>Provides some graph algorithms (not very optimized yet)</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.dijkstra(startNode, endNode, 'KNOWS|&lt;WORKS_WITH|IS_MANAGER_OF&gt;', 'distance') YIELD path, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run dijkstra with relationship property name as cost function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.dijkstraWithDefaultWeight(startNode, endNode, 'KNOWS|&lt;WORKS_WITH|IS_MANAGER_OF&gt;',  'distance', 10) YIELD path, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run dijkstra with relationship property name as cost function and a default weight if the property does not exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.aStar(startNode, endNode, 'KNOWS|&lt;WORKS_WITH|IS_MANAGER_OF&gt;', 'distance','lat','lon')  YIELD path, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run A* with relationship property name as cost function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.aStar(startNode, endNode, 'KNOWS|&lt;WORKS_WITH|IS_MANAGER_OF&gt;', {weight:'dist',default:10, x:'lon',y:'lat'}) YIELD path, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run A* with relationship property name as cost function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.allSimplePaths(startNode, endNode, 'KNOWS|&lt;WORKS_WITH|IS_MANAGER_OF&gt;', 5) YIELD path,  weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run allSimplePaths with relationships given and maxNodes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.betweenness(['TYPE',&#8230;&#8203;],nodes,BOTH) YIELD node, score</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate betweenness  centrality for given nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.closeness(['TYPE',&#8230;&#8203;],nodes, INCOMING) YIELD node, score</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate closeness  centrality for given nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.cover(nodeIds) YIELD rel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return relationships between this set of nodes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.pageRank(nodes) YIELD node, score</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculates page rank for given nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.pageRankWithConfig(nodes,{iterations:_,types:_}) YIELD node, score</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculates page rank for given nodes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.community(times,labels,partitionKey,type,direction,weightKey,batchSize)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple label propagation kernel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.cliques(minSize) YIELD clique</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search the graph and return all maximal cliques at least at  large as the minimum size argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.algo.cliquesWithNode(startNode, minSize) YIELD clique</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search the graph and return all maximal cliques that  are at least as large than the minimum size argument and contain this node</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example: find the weighted shortest path based on relationship property <code>d</code> from <code>A</code> to <code>B</code> following just <code>:ROAD</code> relationships</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (from:Loc{name:'A'}), (to:Loc{name:'D'})
CALL apoc.algo.dijkstra(from, to, 'ROAD', 'd') yield path as path, weight as weight
RETURN path, weight
MATCH (n:Person)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_text_and_lookup_indexes">Text and Lookup Indexes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_index_queries_2">Index Queries</h3>
<div class="paragraph">
<p>Procedures to add to and query manual indexes</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please note that there are (case-sensitive) <a href="http://neo4j.com/docs/developer-manual/current/#cypher-schema">automatic schema indexes</a>, for equality, non-equality, existence, range queries, starts with, ends-with and contains!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addAllNodes('index-name',{label1:['prop1',&#8230;&#8203;],&#8230;&#8203;})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add all nodes to this full text index with the given fields, additionally populates a 'search' index field with all of them in one place</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addNode(node,['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add node to an index for each label it has</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addNodeByLabel(node,'Label',['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add node to an index for the given label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.addRelationship(rel,['prop1',&#8230;&#8203;])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add relationship to an index for its type</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.index.nodes-with-score.jpg" alt="apoc.index.nodes with score" width="600">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.search('index-name', 'query') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search for the first 100 nodes in the given full text index matching the given lucene query returned by relevance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.nodes('Label','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on node index with the given label name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.relationships('TYPE','prop:value*') YIELD rel, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.between(node1,'TYPE',node2,'prop:value*') YIELD rel, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name bound by either or both sides (each node parameter can be null)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.out(node,'TYPE','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name for <strong>outgoing</strong> relationship of the given node, <strong>returns end-nodes</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.index.in(node,'TYPE','prop:value*') YIELD node, weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lucene query on relationship index with the given type name for <strong>incoming</strong> relationship of the given node, <strong>returns start-nodes</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_index_management_2">Index Management</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.list() YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lists all manual indexes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.remove('name') YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removes manual indexes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.forNodes('name',{config}) YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gets or creates manual node index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.index.forRelationships('name',{config}) YIELD type,name,config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gets or creates manual relationship index</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Add node to index example</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">match (p:Person) call apoc.index.addNode(p,["name","age"]) RETURN count(*);
// 129s for 1M People
call apoc.index.nodes('Person','name:name100*') YIELD node, weight return * limit 2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_text_search">Full Text Search</h3>
<div class="paragraph">
<p>Indexes are used for finding nodes in the graph that further operations can then continue from.
Just like in a book where you look at the index to find a section that interest you, and then start reading from there.
A full text index allows you to find occurrences of individual words or phrases across all attributes.</p>
</div>
<div class="paragraph">
<p>In order to use the full text search feature, we have to first index our data by specifying all the attributes we want to index.
Here we create a full text index called <code>locations</code> (we will use this name when searching in the index) with our data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.addAllNodes('locations',{
  Company: ["name", "description"],
  Person:  ["name","address"],
  Address: ["address"]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating the index will take a little while since the procedure has to read through the entire database to create the index.</p>
</div>
<div class="paragraph">
<p>We can now use this index to search for nodes in the database.
The most simple case would be to search across all data for a particular word.</p>
</div>
<div class="paragraph">
<p>It does not matter which property that word exists in, any node that has that word in any of its indexed properties will be found.</p>
</div>
<div class="paragraph">
<p>If you use a name in the call, all occurrences will be found (but limited to 100 results).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.search("locations", 'name')</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_search">Advanced Search</h4>
<div class="paragraph">
<p>We can further restrict our search to only searching in a particular attribute.
In order to search for a <code>Person</code> with an address in <strong>France</strong>, we use the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.search("locations", "Person.address:France")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can search for nodes with a specific property value, and then explore their neighbourhoods visually.</p>
</div>
<div class="paragraph">
<p>But integrating it with an graph query is so much more powerful.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fulltext_and_graph_search">Fulltext and Graph Search</h4>
<div class="paragraph">
<p>We could for instance search for addresses in the database that contain the word "Paris", and then find all companies registered at those addresses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.search("locations", "Address.address:Paris~") YIELD node AS addr
MATCH (addr)&lt;-[:HAS_ADDRESS]-(company:Company)
RETURN company LIMIT 50</code></pre>
</div>
</div>
<div class="paragraph">
<p>The tilde (~) instructs the index search procedure to do a fuzzy match, allowing us to find Paris even if the spelling is slightly off.</p>
</div>
<div class="paragraph">
<p>We might notice that there are addresses that contain the word Paris that are not in Paris, France.
For example there might be a Paris Street somewhere.</p>
</div>
<div class="paragraph">
<p>We can further specify that we want the text to contain both the word Paris, and the word France:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.search("locations", "+Address.address:Paris~ +France~")
YIELD node AS addr
MATCH (addr)&lt;-[:HAS_ADDRESS]-(company:Company)
RETURN company LIMIT 50</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_complex_searches">Complex Searches</h4>
<div class="paragraph">
<p>Things start to get interesting when we look at how the different entities in Paris are connected to one another.
We can do that by finding all the entities with addresses in Paris, then creating all pairs of such entities and finding the shortest path between each such pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.index.search("locations", "+Address.address:Paris~ +France~") YIELD node AS addr
MATCH (addr)&lt;-[:HAS_ADDRESS]-(company:Company)
WITH collect(company) AS companies

// create unique pairs
UNWIND companies AS x UNWIND companies AS y
WITH x, y WHERE ID(x) &lt; ID(y)

MATCH path = shortestPath((x)-[*..10]-(y))
RETURN path</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on the query syntax used in the second parameter of the <code>search</code> procedure,
please see <a href="http://www.lucenetutorial.com/lucene-query-syntax.html">this Lucene query tutorial</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_utility_functions">Utility Functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_phonetic_text_procedures">Phonetic Text Procedures</h3>
<div class="paragraph">
<p>The phonetic text (soundex) procedures allow you to compute the soundex encoding of a given string.
There is also a procedure to compare how similar two strings sound under the soundex algorithm.
All soundex procedures by default assume the used language is US English.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.text.phonetic('Hello, dear User!') YIELD value
RETURN value // will return 'H436'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.text.phoneticDelta('Hello Mr Rabbit', 'Hello Mr Ribbit') // will return '4'  (very similar)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_domain">Extract Domain</h3>
<div class="paragraph">
<p>The procedure <code>apoc.data.domain</code> will take a url or email address and try to determine the domain name.
This can be useful to make easier correlations and equality tests between differently formatted email addresses, and between urls to the same domains but specifying different locations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH 'foo@bar.com' AS email
CALL apoc.data.domain(email) YIELD domain
RETURN domain // will return 'bar.com'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH 'http://www.example.com/all-the-things' AS url
CALL apoc.data.domain(url) YIELD domain
RETURN domain // will return 'www.example.com'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_timetolive_ttl_expire_nodes">TimeToLive (TTL) - Expire Nodes</h4>
<div class="paragraph">
<p>Enable cleanup of expired nodes in <code>neo4j.conf</code> with <code>apoc.ttl.enabled=true</code></p>
</div>
<div class="paragraph">
<p>30s after startup an index is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE INDEX ON :TTL(ttl)</code></pre>
</div>
</div>
<div class="paragraph">
<p>At startup a statement is scheduled to run every 60s (or configure in <code>neo4j.conf</code> -  <code>apoc.ttl.schedule=120</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (t:TTL) where t.ttl &gt; timestamp() WITH t LIMIT 1000 DETACH DELETE t</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ttl</code> property holds the <strong>time when the node is expired in milliseconds since epoch</strong>.</p>
</div>
<div class="paragraph">
<p>You can expire your nodes by setting the :TTL label and the ttl property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n:Foo) WHERE n.bar SET n:TTL, n.ttl = timestamp() + 10000;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a procedure that does the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.date.expire(node,time,'time-unit');
CALL apoc.date.expire(n,100,'s');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_date_and_time_conversions">Date and Time Conversions</h3>
<div class="paragraph">
<p>(thanks @tkroman)</p>
</div>
<div class="sect3">
<h4 id="_conversion_between_formatted_dates_and_timestamps_2">Conversion between formatted dates and timestamps</h4>
<div class="ulist">
<ul>
<li>
<p><code>apoc.date.parseDefault('2015-03-25 03:15:59','s')</code> get Unix time equivalent of given date (in seconds)</p>
</li>
<li>
<p><code>apoc.date.parse('2015/03/25 03-15-59','s','yyyy/MM/dd HH/mm/ss')</code> same as previous, but accepts custom datetime format</p>
</li>
<li>
<p><code>apoc.date.formatDefault(12345,'s')</code> get string representation of date corresponding to given Unix time (in seconds) in UTC time zone</p>
</li>
<li>
<p><code>apoc.date.format(12345,'s', 'yyyy/MM/dd HH/mm/ss')</code> the same as previous, but accepts custom datetime format</p>
</li>
<li>
<p><code>apoc.date.formatTimeZone(12345,'s', 'yyyy/MM/dd HH/mm/ss', 'ABC')</code> the same as previous, but accepts custom time zone</p>
</li>
<li>
<p>possible unit values: <code>ms,s,m,h,d</code> and their long forms.</p>
</li>
<li>
<p>possible time zone values: Either an abbreviation such as <code>PST</code>, a full name such as <code>America/Los_Angeles</code>, or a custom ID such as <code>GMT-8:00</code>. Full names are recommended.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reading_separate_datetime_fields_2">Reading separate datetime fields:</h4>
<div class="paragraph">
<p>Splits date (optionally, using given custom format) into fields returning a map from field name to its value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apoc.date.fields('2015-03-25 03:15:59')</code></p>
</li>
<li>
<p><code>apoc.date.fieldsFormatted('2015-01-02 03:04:05 EET', 'yyyy-MM-dd HH:mm:ss zzz')</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following fields are supported:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Result field</th>
<th class="tableblock halign-left valign-top">Represents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'years'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">year</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'months'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">month of year</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'days'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">day of month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'hours'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hour of day</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'minutes'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minute of hour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'seconds'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">second of minute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'zone'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dohcs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html#timezone">time zone</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_examples">Examples</h4>
<div class="literalblock">
<div class="content">
<pre>  apoc.date.fieldsDefault('2015-03-25 03:15:59') =&gt;
    {
      'Months': 1,
      'Days': 2,
      'Hours': 3,
      'Minutes': 4,
      'Seconds': 5,
      'Years': 2015
    }</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>apoc.date.fields('2015-01-02 03:04:05 EET', 'yyyy-MM-dd HH:mm:ss zzz') =&gt;
  {
    'ZoneId': 'Europe/Bucharest',
    'Months': 1,
    'Days': 2,
    'Hours': 3,
    'Minutes': 4,
    'Seconds': 5,
    'Years': 2015
  }</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>apoc.date.fields('2015/01/02_EET', 'yyyy/MM/dd_z') =&gt;
  {
    'Years': 2015,
    'ZoneId': 'Europe/Bucharest',
    'Months': 1,
    'Days': 2
  }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_on_formats">Notes on formats:</h4>
<div class="ulist">
<ul>
<li>
<p>the default format is <code>yyyy-MM-dd HH:mm:ss</code></p>
</li>
<li>
<p>if the format pattern doesn&#8217;t specify timezone, formatter considers dates to belong to the UTC timezone</p>
</li>
<li>
<p>if the timezone pattern is specified, the timezone is extracted from the date string, otherwise an error will be reported</p>
</li>
<li>
<p>the <code>to/fromSeconds</code> timestamp values are in POSIX (Unix time) system, i.e. timestamps represent the number of seconds elapsed since <a href="https://en.wikipedia.org/wiki/Unix_time">00:00:00 UTC, Thursday, 1 January 1970</a></p>
</li>
<li>
<p>the full list of supported formats is described in <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat JavaDoc</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_algorithms">Graph Algorithms</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_expand_paths">Expand paths</h3>
<div class="paragraph">
<p>expand from start node following the given relationships from min to max-level adhering to the label filters</p>
</div>
<div class="sect3">
<h4 id="_usage">Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.path.expand(startNode &lt;id&gt;|Node, relationshipFilter, labelFilter, minLevel, maxLevel )

CALL apoc.path.expand(startNode &lt;id&gt;|Node|list, 'TYPE|TYPE_OUT&gt;|&lt;TYPE_IN', '+YesLabel|-NoLabel', minLevel, maxLevel ) yield path</code></pre>
</div>
</div>
<div class="paragraph">
<p>Relationship Filter</p>
</div>
<div class="paragraph">
<p>Syntax: <code>[&lt;]RELATIONSHIP_TYPE1[&gt;]|[&lt;]RELATIONSHIP_TYPE2[&gt;]|&#8230;&#8203;</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">input</th>
<th class="tableblock halign-left valign-top">type</th>
<th class="tableblock halign-left valign-top">direction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKES&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKES</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>OUTGOING</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;FOLLOWS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FOLLOWS</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>INCOMING</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KNOWS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KNOWS</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>BOTH</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Label Filter</p>
</div>
<div class="paragraph">
<p>Syntax: <code>[+-/]LABEL1|LABEL2|&#8230;&#8203;</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">input</th>
<th class="tableblock halign-left valign-top">label</th>
<th class="tableblock halign-left valign-top">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+Friend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Friend</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>include label (whitelist)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Foe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Foe</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>exclude label (blacklist)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Friend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Friend</code></p></td>
<td class="tableblock halign-left valign-top"><div><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>

</div>
<div class="paragraph">
<p>stop traversal after reaching a friend (but include him)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_examples_2">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.path.expand(1,"ACTED_IN&gt;|PRODUCED&lt;|FOLLOWS&lt;","+Movie|Person",0,3)
call apoc.path.expand(1,"ACTED_IN&gt;|PRODUCED&lt;|FOLLOWS&lt;","-BigBrother",0,3)
call apoc.path.expand(1,"ACTED_IN&gt;|PRODUCED&lt;|FOLLOWS&lt;","",0,3)

// combined with cypher:

match (tom:Person {name :"Tom Hanks"})
call apoc.path.expand(tom,"ACTED_IN&gt;|PRODUCED&lt;|FOLLOWS&lt;","+Movie|Person",0,3) yield path as pp
return pp;

// or

match (p:Person) with p limit 3
call apoc.path.expand(p,"ACTED_IN&gt;|PRODUCED&lt;|FOLLOWS&lt;","+Movie|Person",1,2) yield path as pp
return p, pp</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expand_with_config">Expand with Config</h4>
<div class="listingblock">
<div class="content">
<pre>apoc.path.expandConfig(startNode &lt;id&gt;Node/list, {config}) yield path expands from start nodes using the given configuration and yields the resulting paths</pre>
</div>
</div>
<div class="paragraph">
<p>Takes an additional config to provide configuration options:</p>
</div>
<div class="listingblock">
<div class="title">Config</div>
<div class="content">
<pre>{minLevel: -1|number,
 maxLevel: -1|number,
 relationshipFilter: '[&lt;]RELATIONSHIP_TYPE1[&gt;]|[&lt;]RELATIONSHIP_TYPE2[&gt;]|...',
 labelFilter: '[+-]LABEL1|LABEL2|...',
 uniqueness: RELATIONSHIP_PATH|NONE|NODE_GLOBAL|NODE_LEVEL|NODE_PATH|NODE_RECENT|RELATIONSHIP_GLOBAL|RELATIONSHIP_LEVEL|RELATIONSHIP_RECENT,
 bfs: true|false}</pre>
</div>
</div>
<div class="paragraph">
<p>So you can turn this cypher query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (user:User) WHERE user.id = 460
MATCH (user)-[:RATED]-&gt;(movie)&lt;-[:RATED]-(collab)-[:RATED]-&gt;(reco)
RETURN count(*);</code></pre>
</div>
</div>
<div class="paragraph">
<p>into this procedure call, with changed semantics for uniqueness and bfs (which is Cypher&#8217;s expand mode)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (user:User) WHERE user.id = 460
CALL apoc.path.expandConfig(user,{relationshipFilter:"RATED",minLevel:3,maxLevel:3,bfs:false,uniqueness:"NONE"}) YIELD path
RETURN count(*);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_centrality_algorithms">Centrality Algorithms</h3>
<div class="sect3">
<h4 id="_setup">Setup</h4>
<div class="paragraph">
<p>Let&#8217;s create some test data to run the Centrality algorithms on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">// create 100 nodes
FOREACH (id IN range(0,1000) | CREATE (:Node {id:id}))

// over the cross product (1M) create 100.000 relationships
MATCH (n1:Node),(n2:Node) WITH n1,n2 LIMIT 1000000 WHERE rand() &lt; 0.1

CREATE (n1)-[:TYPE]-&gt;(n2)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closeness_centrality_procedure">Closeness Centrality Procedure</h4>
<div class="paragraph">
<p>Centrality is an indicator of a node&#8217;s influence in a graph. In graphs there is a natural distance metric between pairs of nodes, defined by the length of their shortest paths.</p>
</div>
<div class="paragraph">
<p>Closeness Centrality defines the farness of a node as the sum of its distances from all other nodes, and its closeness as the reciprocal of farness.</p>
</div>
<div class="paragraph">
<p>The more central a node is the lower its total distance from all other nodes.</p>
</div>
<div class="paragraph">
<p>Complexity: This procedure uses a BFS shortest path algorithm. With BFS the complexes becomes <code>O(n * m)</code>
Caution: Due to the complexity of this algorithm it is recommended to run it on only the nodes you are interested in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node:Node)
WHERE node.id %2 = 0
WITH collect(node) AS nodes
CALL apoc.algo.closeness(['TYPE'],nodes,'INCOMING') YIELD node, score
RETURN node, score
ORDER BY score DESC</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_betweenness_centrality_procedure">Betweenness Centrality Procedure</h4>
<div class="paragraph">
<p>The procedure will compute betweenness centrality as defined by Linton C. Freeman (1977) using the algorithm by Ulrik Brandes (2001).
Centrality is an indicator of a node&#8217;s influence in a graph.</p>
</div>
<div class="paragraph">
<p>Betweenness Centrality is equal to the number of shortest paths from all nodes to all others that pass through that node.</p>
</div>
<div class="paragraph">
<p>High centrality suggests a large influence on the transfer of items through the graph.</p>
</div>
<div class="paragraph">
<p>Centrality is applicable to numerous domains, including: social networks, biology, transport and scientific cooperation.</p>
</div>
<div class="paragraph">
<p>Complexity: This procedure uses a BFS shortest path algorithm. With BFS the complexes becomes O(n * m)
Caution: Due to the complexity of this algorithm it is recommended to run it on only the nodes you are interested in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node:Node)
WHERE node.id %2 = 0
WITH collect(node) AS nodes
CALL apoc.algo.betweenness(['TYPE'],nodes,'BOTH') YIELD node, score
RETURN node, score
ORDER BY score DESC</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pagerank_algorithm">PageRank Algorithm</h3>
<div class="sect3">
<h4 id="_setup_2">Setup</h4>
<div class="paragraph">
<p>Let&#8217;s create some test data to run the PageRank algorithm on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">// create 100 nodes
FOREACH (id IN range(0,1000) | CREATE (:Node {id:id}))

// over the cross product (1M) create 100.000 relationships
MATCH (n1:Node),(n2:Node) WITH n1,n2 LIMIT 1000000 WHERE rand() &lt; 0.1

CREATE (n1)-[:TYPE_1]-&gt;(n2)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pagerank_procedure">PageRank Procedure</h4>
<div class="paragraph">
<p>PageRank is an algorithm used by Google Search to rank websites in their search engine results.</p>
</div>
<div class="paragraph">
<p>It is a way of measuring the importance of nodes in a graph.</p>
</div>
<div class="paragraph">
<p>PageRank counts the number and quality of relationships to a node to approximate the importance of that node.</p>
</div>
<div class="paragraph">
<p>PageRank assumes that more important nodes likely have more relationships.</p>
</div>
<div class="paragraph">
<p>Caution: <code>nodes</code> specifies the nodes for which a PageRank score will be projected, but the procedure will <em>always</em> compute the PageRank algorithm on the <em>entire</em> graph. At present, there is no way to filter/reduce the number of elements that PageRank computes over.</p>
</div>
<div class="paragraph">
<p>A future version of this procedure will provide the option of computing PageRank on a subset of the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node:Node)
WHERE node.id %2 = 0
WITH collect(node) AS nodes
// compute over relationships of all types
CALL apoc.algo.pageRank(nodes) YIELD node, score
RETURN node, score
ORDER BY score DESC</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node:Node)
WHERE node.id %2 = 0
WITH collect(node) AS nodes
// only compute over relationships of types TYPE_1 or TYPE_2
CALL apoc.algo.pageRankWithConfig(nodes,{types:'TYPE_1|TYPE_2'}) YIELD node, score
RETURN node, score
ORDER BY score DESC</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node:Node)
WHERE node.id %2 = 0
WITH collect(node) AS nodes
// peroform 10 page rank iterations, computing only over relationships of type TYPE_1
CALL apoc.algo.pageRankWithConfig(nodes,{iterations:10,types:'TYPE_1'}) YIELD node, score
RETURN node, score
ORDER BY score DESC</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spatial_2">Spatial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spatial_functions">Spatial Functions</h3>
<div class="paragraph">
<p>The spatial procedures are intended to enable geographic capabilities on your data.</p>
</div>
<div class="sect3">
<h4 id="_geocode">geocode</h4>
<div class="paragraph">
<p>The first procedure <em>geocode</em> which will convert a textual address
into a location containing <em>latitude</em>, <em>longitude</em> and <em>description</em>. Despite being
only a single function, together with the built-in functions <em>point</em> and <em>distance</em>
we can achieve quite powerful results.</p>
</div>
<div class="paragraph">
<p>First, how can we use the procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.spatial.geocodeOnce('21 rue Paul Bellamy 44000 NANTES FRANCE') YIELD location
RETURN location.latitude, location.longitude // will return 47.2221667, -1.5566624</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two forms of the procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>geocodeOnce(address) returns zero or one result</p>
</li>
<li>
<p>geocode(address,maxResults) returns zero, one or more up to maxResults</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is because the backing geocoding service (OSM, Google, OpenCage or other) might return multiple
results for the same query. GeocodeOnce() is designed to return the first, or highest
ranking result.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_geocode">Configuring Geocode</h4>
<div class="paragraph">
<p>There are a few options that can be set in the neo4j.conf file to control the service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apoc.spatial.geocode.provider=osm (osm, google, opencage, etc.)</p>
</li>
<li>
<p>apoc.spatial.geocode.osm.throttle=5000 (ms to delay between queries to not overload OSM servers)</p>
</li>
<li>
<p>apoc.spatial.geocode.google.throttle=1 (ms to delay between queries to not overload Google servers)</p>
</li>
<li>
<p>apoc.spatial.geocode.google.key=xxxx (API key for google geocode access)</p>
</li>
<li>
<p>apoc.spatial.geocode.google.client=xxxx (client code for google geocode access)</p>
</li>
<li>
<p>apoc.spatial.geocode.google.signature=xxxx (client signature for google geocode access)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For google, you should use either a key or a combination of client and signature. Read more
about this on the google page for geocode access at
<a href="https://developers.google.com/maps/documentation/geocoding/get-api-key#key" class="bare">https://developers.google.com/maps/documentation/geocoding/get-api-key#key</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_custom_geocode_provider">Configuring Custom Geocode Provider</h4>
<div class="paragraph">
<p>For any provider that is not 'osm' or 'google' you get a configurable supplier that requires two
additional settings, 'url' and 'key'. The 'url' must contain the two words 'PLACE' and 'KEY'.
The 'KEY' will be replaced with the key you get from the provider when you register for the service.
The 'PLACE' will be replaced with the address to geocode when the procedure is called.</p>
</div>
<div class="paragraph">
<p>For example, to get the service working with OpenCage, perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register your own application key at <a href="https://geocoder.opencagedata.com/" class="bare">https://geocoder.opencagedata.com/</a></p>
</li>
<li>
<p>Once you have a key, add the following three lines to neo4j.conf</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>apoc.spatial.geocode.provider=opencage
apoc.spatial.geocode.opencage.key=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
apoc.spatial.geocode.opencage.url=http://api.opencagedata.com/geocode/v1/json?q=PLACE&amp;key=KEY</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>make sure that the 'XXXXXXX' part above is replaced with your actual key</p>
</li>
<li>
<p>Restart the Neo4j server and then test the geocode procedures to see that they work</p>
</li>
<li>
<p>If you are unsure if the provider is correctly configured try verify with:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.spatial.showConfig()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_geocode_within_a_bigger_cypher_query">Using Geocode within a bigger Cypher query</h4>
<div class="paragraph">
<p>A more complex, or useful, example which geocodes addresses found in properties of nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Place)
WHERE exists(a.address)
CALL apoc.spatial.geocodeOnce(a.address) YIELD location
RETURN location.latitude AS latitude, location.longitude AS longitude, location.description AS description</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calculating_distance_between_locations">Calculating distance between locations</h4>
<div class="paragraph">
<p>If we wish to calculate the distance between addresses, we need to use the point() function to convert
latitude and longitude to Cyper Point types, and then use the distance() function to calculate the distance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH point({latitude: 48.8582532, longitude: 2.294287}) AS eiffel
MATCH (a:Place)
WHERE exists(a.address)
CALL apoc.spatial.geocodeOnce(a.address) YIELD location
WITH location, distance(point(location), eiffel) AS distance
WHERE distance &lt; 5000
RETURN location.description AS description, distance
ORDER BY distance
LIMIT 100</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_sortpathsbydistance">sortPathsByDistance</h5>
<div class="paragraph">
<p>The second procedure enables you to sort a given collection of paths by the sum of their distance based on lat/long properties
on the nodes.</p>
</div>
<div class="paragraph">
<p>Sample data :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (bruges:City {name:"bruges", latitude: 51.2605829, longitude: 3.0817189})
CREATE (brussels:City {name:"brussels", latitude: 50.854954, longitude: 4.3051786})
CREATE (paris:City {name:"paris", latitude: 48.8588376, longitude: 2.2773455})
CREATE (dresden:City {name:"dresden", latitude: 51.0767496, longitude: 13.6321595})
MERGE (bruges)-[:NEXT]-&gt;(brussels)
MERGE (brussels)-[:NEXT]-&gt;(dresden)
MERGE (brussels)-[:NEXT]-&gt;(paris)
MERGE (bruges)-[:NEXT]-&gt;(paris)
MERGE (paris)-[:NEXT]-&gt;(dresden)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finding paths and sort them by distance</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:City {name:'bruges'}), (b:City {name:'dresden'})
MATCH p=(a)-[*]-&gt;(b)
WITH collect(p) as paths
CALL apoc.spatial.sortPathsByDistance(paths) YIELD path, distance
RETURN path, distance</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_graph_refactoring_2">Graph Refactoring</h4>
<div class="paragraph">
<p>In order not to have to repeatedly geocode the same thing in multiple queries, especially
if the database will be used by many people, it might be a good idea to persist the results
in the database so that subsequent calls can use the saved results.</p>
</div>
<div class="paragraph">
<p>Geocode and persist the result</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Place)
WHERE exists(a.address) AND NOT exists(a.latitude)
WITH a LIMIT 1000
CALL apoc.spatial.geocodeOnce(a.address) YIELD location
SET a.latitude = location.latitude
SET a.longitude = location.longitude</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the above command only geocodes the first 1000 Place nodes that have not already been geocoded.
This query can be run multiple times until all places are geocoded. Why would we want to do this?
Two good reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The geocoding service is a public service that can throttle or blacklist sites that hit the service too heavily, so controlling how much we do is useful.</p>
</li>
<li>
<p>The transaction is updating the database, and it is wise not to update the database with too many things in the same transaction, to avoid using up too much memory. This trick will keep the memory usage very low.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now make use of the results in distance queries</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH point({latitude: 48.8582532, longitude: 2.294287}) AS eiffel
MATCH (a:Place)
WHERE exists(a.latitude) AND exists(a.longitude)
WITH a, distance(point(a), eiffel) AS distance
WHERE distance &lt; 5000
RETURN a.name, distance
ORDER BY distance
LIMIT 100</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combined_space_and_time_search">Combined Space and Time search</h4>
<div class="paragraph">
<p>Combining spatial and date-time procedures can allow for more complex queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.date.parse('2016-06-01 00:00:00','h') YIELD value AS due_date
WITH due_date,
point({latitude: 48.8582532, longitude: 2.294287}) AS eiffel
MATCH (e:Event)
WHERE exists(e.address) AND exists(e.datetime)
CALL apoc.spatial.geocodeOnce(e.address) YIELD location
CALL apoc.date.parse(e.datetime,'h') YIELD value AS hours
WITH e, location,
distance(point(location), eiffel) AS distance,
            (due_date - hours)/24.0 AS days_before_due
WHERE distance &lt; 5000 AND days_before_due &lt; 14 AND hours &lt; due_date
RETURN e.name AS event, e.datetime AS date,
location.description AS description, distance
ORDER BY distance</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_integration">Data Integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_load_json">Load JSON</h3>
<div class="paragraph">
<p>Example for reverse geocoding and determining the route from one to another location.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH
        "21 rue Paul Bellamy 44000 NANTES FRANCE" AS fromAddr,
        "125 rue du docteur guichard 49000 ANGERS FRANCE" AS toAddr

call apoc.load.json("http://www.yournavigation.org/transport.php?url=http://nominatim.openstreetmap.org/search&amp;format=json&amp;q=" + replace(fromAddr, ' ', '%20')) YIELD value AS from

WITH from, toAddr  LIMIT 1

call apoc.load.json("http://www.yournavigation.org/transport.php?url=http://nominatim.openstreetmap.org/search&amp;format=json&amp;q=" + replace(toAddr, ' ', '%20')) YIELD value AS to

CALL apoc.load.json("https://router.project-osrm.org/viaroute?instructions=true&amp;alt=true&amp;z=17&amp;loc=" + from.lat + "," + from.lon + "&amp;loc=" + to.lat + "," + to.lon ) YIELD value AS doc

UNWIND doc.route_instructions as instruction

RETURN instruction</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_load_json_with_additional_parameters">Load Json with additional parameters</h4>
<div class="paragraph">
<p>With <code>apoc.load.jsonParams</code> you can send additional headers or payload with your JSON GET request, e.g. for the Twitter API:</p>
</div>
<div class="paragraph">
<p>Configure Bearer and Twitter Search Url token in <code>neo4j.conf</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>apoc.static.twitter.bearer=XXXX
apoc.static.twitter.url=https://api.twitter.com/1.1/search/tweets.json?count=100&amp;result_type=recent&amp;lang=en&amp;q=</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Twitter Search via Cypher</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.static.getAll("twitter") yield value AS twitter
CALL apoc.load.jsonParams(twitter.url + "oscon+OR+neo4j+OR+%23oscon+OR+%40neo4j",{Authorization:"Bearer "+twitter.bearer},null) yield value
UNWIND value.statuses as status
WITH status, status.user as u, status.entities as e
RETURN status.id, status.text, u.screen_name, [t IN e.hashtags | t.text] as tags, e.symbols, [m IN e.user_mentions | m.screen_name] as mentions, [u IN e.urls | u.expanded_url] as urls</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_load_json_stackoverflow_example">Load JSON StackOverflow Example</h4>
<div class="paragraph">
<p>There have been articles before about <a href="http://neo4j.com/blog/cypher-load-json-from-url/">loading JSON from Web-APIs like StackOverflow</a>.</p>
</div>
<div class="paragraph">
<p>With <code>apoc.load.json</code> it&#8217;s now very easy to load JSON data from any file or URL.</p>
</div>
<div class="paragraph">
<p>If the result is a JSON object is returned as a singular map.
Otherwise if it was an array is turned into a stream of maps.</p>
</div>
<div class="paragraph">
<p>The URL for retrieving the last questions and answers of the <a href="http://stackoverflow.com/questions/tagged/neo4j">neo4j tag</a> is this:</p>
</div>
<div class="paragraph">
<p><a href="https://api.stackexchange.com/2.2/questions?pagesize=100&amp;order=desc&amp;sort=creation&amp;tagged=neo4j&amp;site=stackoverflow&amp;filter=!5-i6Zw8Y)4W7vpy91PMYsKM-k9yzEsSC1_Uxlf" class="bare">https://api.stackexchange.com/2.2/questions?pagesize=100&amp;order=desc&amp;sort=creation&amp;tagged=neo4j&amp;site=stackoverflow&amp;filter=!5-i6Zw8Y)4W7vpy91PMYsKM-k9yzEsSC1_Uxlf</a></p>
</div>
<div class="paragraph">
<p>Now it can be used from within Cypher directly, let&#8217;s first introspect the data that is returned.</p>
</div>
<div class="listingblock">
<div class="title">JSON data from StackOverflow</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH "https://api.stackexchange.com/2.2/questions?pagesize=100&amp;order=desc&amp;sort=creation&amp;tagged=neo4j&amp;site=stackoverflow&amp;filter=!5-i6Zw8Y)4W7vpy91PMYsKM-k9yzEsSC1_Uxlf" AS url
CALL apoc.load.json(url) YIELD value
UNWIND value.items AS item
RETURN item.title, item.owner, item.creation_date, keys(item)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.load.json.so.png" alt="apoc.load.json.so">
</div>
</div>
<div class="paragraph">
<p>Combined with the cypher query from the original blog post it&#8217;s easy to create the full Neo4j graph of those entities.</p>
</div>
<div class="listingblock">
<div class="title">Graph data created via loading JSON from StackOverflow</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH "https://api.stackexchange.com/2.2/questions?pagesize=100&amp;order=desc&amp;sort=creation&amp;tagged=neo4j&amp;site=stackoverflow&amp;filter=!5-i6Zw8Y)4W7vpy91PMYsKM-k9yzEsSC1_Uxlf" AS url
CALL apoc.load.json(url) YIELD value
UNWIND value.items AS q
MERGE (question:Question {id:q.question_id}) ON CREATE
  SET question.title = q.title, question.share_link = q.share_link, question.favorite_count = q.favorite_count

MERGE (owner:User {id:q.owner.user_id}) ON CREATE SET owner.display_name = q.owner.display_name
MERGE (owner)-[:ASKED]-&gt;(question)

FOREACH (tagName IN q.tags | MERGE (tag:Tag {name:tagName}) MERGE (question)-[:TAGGED]-&gt;(tag))
FOREACH (a IN q.answers |
   MERGE (question)&lt;-[:ANSWERS]-(answer:Answer {id:a.answer_id})
   MERGE (answerer:User {id:a.owner.user_id}) ON CREATE SET answerer.display_name = a.owner.display_name
   MERGE (answer)&lt;-[:PROVIDED]-(answerer)
)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.load.json-so-result.png" alt="apoc.load.json so result">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_load_jdbc">Load JDBC</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.jdbc('jdbc:derby:derbyDB','PERSON') YIELD row CREATE (:Person {name:row.name})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from relational database, either a full table or a sql statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.jdbc('jdbc:derby:derbyDB','SELECT * FROM PERSON WHERE AGE &gt; 18')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load from relational database, either a full table or a sql statement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.load.driver('org.apache.derby.jdbc.EmbeddedDriver')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register JDBC driver of source database</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To simplify the JDBC URL syntax, for example 'jdbc:derby:derbyDB', and so as to mask the details one can define in conf/neo4j.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apoc.jdbc.derby.url=jdbc:derby:derbyDB</pre>
</div>
</div>
<div class="paragraph">
<p>and then</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CALL apoc.load.jdbc('jdbc:derby:derbyDB','PERSON') YIELD row CREATE (:Person {name:row.name})</pre>
</div>
</div>
<div class="paragraph">
<p>becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CALL apoc.load.jdbc('derby','PERSON') YIELD row CREATE (:Person {name:row.name})</pre>
</div>
</div>
<div class="paragraph">
<p>The 3rd value in the 'apoc.jdbc.derby.url=' effectively defines an &lt;alias&gt; to be used in the apoc.load.jdbc('&lt;alias&gt;',&#8230;&#8203;.</p>
</div>
<div class="sect3">
<h4 id="_mysql_example">MySQL Example</h4>
<div class="sect4">
<h5 id="_mysql_northwind_data">MySQL Northwind Data</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">select count(*) from products;
+----------+
| count(*) |
+----------+
|       77 |
+----------+
1 row in set (0,00 sec)

describe products;
+-----------------+---------------+------+-----+---------+----------------+
| Field           | Type          | Null | Key | Default | Extra          |
+-----------------+---------------+------+-----+---------+----------------+
| ProductID       | int(11)       | NO   | PRI | NULL    | auto_increment |
| ProductName     | varchar(40)   | NO   | MUL | NULL    |                |
| SupplierID      | int(11)       | YES  | MUL | NULL    |                |
| CategoryID      | int(11)       | YES  | MUL | NULL    |                |
| QuantityPerUnit | varchar(20)   | YES  |     | NULL    |                |
| UnitPrice       | decimal(10,4) | YES  |     | 0.0000  |                |
| UnitsInStock    | smallint(2)   | YES  |     | 0       |                |
| UnitsOnOrder    | smallint(2)   | YES  |     | 0       |                |
| ReorderLevel    | smallint(2)   | YES  |     | 0       |                |
| Discontinued    | bit(1)        | NO   |     | b'0'    |                |
+-----------------+---------------+------+-----+---------+----------------+
10 rows in set (0,00 sec)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_load_jdbc_examples">Load JDBC Examples</h4>
<div class="listingblock">
<div class="title">Load the JDBC driver</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">cypher CALL apoc.load.driver("com.mysql.jdbc.Driver");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Count rows in products table</div>
<div class="content">
<pre>with "jdbc:mysql://localhost:3306/northwind?user=root" as url
cypher CALL apoc.load.jdbc(url,"products") YIELD row
RETURN count(*);</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+----------+
| count(*) |
+----------+
| 77       |
+----------+
1 row
23 ms</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Return row from products table</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">with "jdbc:mysql://localhost:3306/northwind?user=root" as url
cypher CALL apoc.load.jdbc(url,"products") YIELD row
RETURN row limit 1;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+--------------------------------------------------------------------------------+
| row                                                                            |
+--------------------------------------------------------------------------------+
| {UnitPrice -&gt; 18.0000, UnitsOnOrder -&gt; 0, CategoryID -&gt; 1, UnitsInStock -&gt; 39} |
+--------------------------------------------------------------------------------+
1 row
10 ms</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc-load-jdbc.jpg" alt="apoc load jdbc" width="800">
</div>
</div>
<div class="listingblock">
<div class="title">Create data from jdbc query results in batches (and in parallel).</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.periodic.iterate('
call apoc.load.jdbc("jdbc:mysql://localhost:3306/northwind?user=root","company")',
'CREATE (p:Person) SET p += value', {batchSize:10000, parallel:true})
RETURN batches, total</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cassandra_example">Cassandra Example</h4>
<div class="paragraph">
<p>Setup Song database as initial dataset</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -OL https://raw.githubusercontent.com/neo4j-contrib/neo4j-cassandra-connector/master/db_gen/playlist.cql
curl -OL https://raw.githubusercontent.com/neo4j-contrib/neo4j-cassandra-connector/master/db_gen/artists.csv
curl -OL https://raw.githubusercontent.com/neo4j-contrib/neo4j-cassandra-connector/master/db_gen/songs.csv
$CASSANDRA_HOME/bin/cassandra
$CASSANDRA_HOME/bin/cqlsh -f playlist.cql</pre>
</div>
</div>
<div class="paragraph">
<p>Download the <a href="https://github.com/adejanovski/cassandra-jdbc-wrapper#installing">Cassandra JDBC Wrapper</a>, and put it into your <code>$NEO4J_HOME/plugins</code> directory.
Add this config option to <code>$NEO4J_HOME/conf/neo4j.conf</code> to make it easier to interact with the cassandra instance.</p>
</div>
<div class="listingblock">
<div class="title">Add to conf/neo4j.conf</div>
<div class="content">
<pre>apoc.jdbc.cassandra_songs.url=jdbc:cassandra://localhost:9042/playlist</pre>
</div>
</div>
<div class="paragraph">
<p>Restart the server.</p>
</div>
<div class="paragraph">
<p>Now you can inspect the data in Cassandra with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','artists_by_first_letter') yield row
RETURN count(*);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
count(*)

3605    
</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','artists_by_first_letter') yield row
RETURN row LIMIT 5;

CALL apoc.load.jdbc('cassandra_songs','artists_by_first_letter') yield row
RETURN row.first_letter, row.artist LIMIT 5;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
row.first_letterrow.artist                     

C               C.W. Stoneking                 

C               CH2K                           

C               CHARLIE HUNTER WITH LEON PARKER

C               Calvin Harris                  

C               Caman                         
</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create some graph data, we have a look at the track_by_artist table, which contains about 60k records.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','track_by_artist') yield row RETURN count(*);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','track_by_artist') yield row
RETURN row LIMIT 5;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','track_by_artist') yield row
RETURN row.track_id, row.track_length_in_seconds, row.track, row.music_file, row.genre, row.artist, row.starred LIMIT 2;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
row.track_id                        lengthrow.track       row.music_file    row.genrerow.artist                  row.starred

c0693b1e-0eaa-4e81-b23f-b083db303842219   1913 Massacre   TRYKHMD128F934154Cfolk     Woody Guthrie &amp; Jack Elliottfalse      

7d114937-0bc7-41c7-8e0c-94b5654ac77f178   Alabammy Bound  TRMQLPV128F934152Bfolk     Woody Guthrie &amp; Jack Elliottfalse      
</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create some indexes and constraints, note that other indexes and constraints will be dropped by this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.schema.assert(
  {Track:['title','length']},
  {Artist:['name'],Track:['id'],Genre:['name']});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
label       key    uniqueaction 

Track       title  false CREATED

Track       length false CREATED

Artist      name   true  CREATED

Genre       name   true  CREATED

Track       id     true  CREATED
</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.load.jdbc('cassandra_songs','track_by_artist') yield row
MERGE (a:Artist {name:row.artist})
MERGE (g:Genre {name:row.genre})
CREATE (t:Track {id:toString(row.track_id), title:row.track, length:row.track_length_in_seconds})
CREATE (a)-[:PERFORMED]-&gt;(t)
CREATE (t)-[:GENRE]-&gt;(g);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Added 63213 labels, created 63213 nodes, set 182413 properties, created 119200 relationships, statement executed in 40076 ms.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_data_to_gephi_2">Streaming Data to Gephi</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.gephi.add(url-or-key, workspace, data)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams provided data to Gephi</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_notes_2">Notes</h3>
<div class="paragraph">
<p>Gephi has a <a href="https://marketplace.gephi.org/plugin/graph-streaming/">streaming plugin</a>, that can provide and accept <a href="https://github.com/gephi/gephi/wiki/GraphStreaming#Gephi_as_Master">JSON-graph-data</a> in a streaming fashion.</p>
</div>
<div class="paragraph">
<p>Make sure to install the plugin firsrt and activate it for your workspace (there is a new "Streaming"-tab besides "Layout"), right-click "Master"&#8594;"start" to start the server.</p>
</div>
<div class="paragraph">
<p>You can provide your workspace name (you might want to rename it before you start thes streaming), otherwise it defaults to <code>workspace0</code></p>
</div>
<div class="paragraph">
<p>The default Gephi-URL is <a href="http://localhost:8080" class="bare">http://localhost:8080</a>, resulting in <code><a href="http://localhost:8080/workspace0?operation=updateGraph" class="bare">http://localhost:8080/workspace0?operation=updateGraph</a></code></p>
</div>
<div class="paragraph">
<p>You can also configure it in <code>conf/neo4j.conf</code> via  <code>apoc.gephi.url=url</code> or <code>apoc.gephi.&lt;key&gt;.url=url</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_example_2">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">match path = (:Person)-[:ACTED_IN]-&gt;(:Movie)
WITH path LIMIT 1000
with collect(path) as paths
call apoc.gephi.add(null,'workspace0', paths) yield nodes, relationships, time
return nodes, relationships, time</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="http://neo4j-contrib.github.io/neo4j-apoc-procedures/docs/img/apoc.gephi.gif" alt="apoc.gephi" width="800">
</div>
</div>
<div class="sect3">
<h4 id="_format">Format</h4>
<div class="paragraph">
<p>We send all nodes and relationships of the passed in data convert into individual Gephi-Streaming JSON fragements, separated by <code>\r\n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{"an":{"123":{"TYPE":"Person:Actor","label":"Tom Hanks",                           x:333,y:222,r:0.1,g:0.3,b:0.5}}}\r\n
{"an":{"345":{"TYPE":"Movie","label":"Forrest Gump",                               x:234,y:122,r:0.2,g:0.2,b:0.7}}}\r\n
{"ae":{"3344":{"TYPE":"ACTED_IN","label":"Tom Hanks",source:"123",target:"345","directed":true,r:0.1,g:0.3,b:0.5}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specifics_details">Specifics Details</h4>
<div class="paragraph">
<p>Gephi doesn&#8217;t render the graph data unless you also provide x,y coordinates in the payload, so we just send random ones within a 1000x1000 grid.</p>
</div>
<div class="paragraph">
<p>We also generate colors per label combination and relationship-type, both of which are also transferred as <code>TYPE</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_elasticsearch_integration">ElasticSearch Integration</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.stats(host-url-Key)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elastic search statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.get(host-or-port,index-or-null,type-or-null,id-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a GET operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.query(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a SEARCH operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.getRaw(host-or-port,path,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a raw GET operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.postRaw(host-or-port,path,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a raw POST operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.post(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a POST operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apoc.es.put(host-or-port,index-or-null,type-or-null,query-or-null,payload-or-null) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform a PUT operation</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_3">Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.es.post("localhost","tweets","users","1",null,{name:"Chris"})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.es.get("localhost","tweets","users","1",null,null)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.es.stats("localhost")</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="http://i.imgur.com/qHAj9ma.png" alt="qHAj9ma" width="500">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_general_structure_and_parameters">General Structure and Parameters</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.es.post(host-or-port,index-or-null,type-or-null,id-or-null,query-or-null,payload-or-null) yield value

// GET/PUT/POST url/index/type/id?query -d payload</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_host_or_port_parameter">host or port parameter</h5>
<div class="paragraph">
<p>The parameter can be a direct host or url, or an entry to be lookup up in neo4j.conf</p>
</div>
<div class="ulist">
<ul>
<li>
<p>host</p>
</li>
<li>
<p>host:port</p>
</li>
<li>
<p><a href="http://host:port" class="bare">http://host:port</a></p>
</li>
<li>
<p>lookup via key to apoc.es.&lt;key&gt;.url</p>
</li>
<li>
<p>lookup via key apoc.es.&lt;key&gt;.host</p>
</li>
<li>
<p>lookup apoc.es.url</p>
</li>
<li>
<p>lookup apoc.es.host</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_index_parameter">index parameter</h5>
<div class="paragraph">
<p>Main ES index, will be sent directly, if null then "_all" multiple indexes can be separated by comma in the string.</p>
</div>
</div>
<div class="sect4">
<h5 id="_type_parameter">type parameter</h5>
<div class="paragraph">
<p>Document type, will be sent directly, if null then "_all" multiple types can be separated by comma in the string.</p>
</div>
</div>
<div class="sect4">
<h5 id="_id_parameter">id parameter</h5>
<div class="paragraph">
<p>Document id, will be left off when null.</p>
</div>
</div>
<div class="sect4">
<h5 id="_query_parameter">query parameter</h5>
<div class="paragraph">
<p>Query can be a map which is turned into a query string, a direct string or null then it is left off.</p>
</div>
</div>
<div class="sect4">
<h5 id="_payload_parameter">payload parameter</h5>
<div class="paragraph">
<p>Payload can be a <strong>map</strong> which will be turned into a json payload or a string which will be sent directly or null.</p>
</div>
</div>
<div class="sect4">
<h5 id="_results">Results</h5>
<div class="paragraph">
<p>Results are stream of map in value.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_load_xml">Load XML</h3>
<div class="sect3">
<h4 id="_example_how_do_you_access_xml_doc_attributes_in_children_fields">Example: How do you access xml doc attributes in children fields ?</h4>
<div class="paragraph">
<p>(Thanks Nicolas Rouyer)</p>
</div>
<div class="paragraph">
<p>For example, if my XML file is the example <a href="https://msdn.microsoft.com/en-us/library/ms762271%28v=vs.85%29.aspx">book.xml provided by microsoft</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;catalog&gt;
   &lt;book id="bk101"&gt;
      &lt;author&gt;Gambardella, Matthew&lt;/author&gt;
      &lt;title&gt;XML Developer's Guide&lt;/title&gt;
      &lt;genre&gt;Computer&lt;/genre&gt;
      &lt;price&gt;44.95&lt;/price&gt;
      &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;
      &lt;description&gt;An in-depth look at creating applications
      with XML.&lt;/description&gt;
   &lt;/book&gt;
   &lt;book id="bk102"&gt;
      &lt;author&gt;Ralls, Kim&lt;/author&gt;
      &lt;title&gt;Midnight Rain&lt;/title&gt;
      &lt;genre&gt;Fantasy&lt;/genre&gt;
      &lt;price&gt;5.95&lt;/price&gt;
      &lt;publish_date&gt;2000-12-16&lt;/publish_date&gt;
      &lt;description&gt;A former architect battles corporate zombies,
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have the file here: <a href="https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml" class="bare">https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s just load it and see what it looks like, it&#8217;s returned as value map with nested <code>_type</code> and <code>_children</code> fields, per group of elements.
Attributes are turned into map-entries.
And elements into their own little map with <code>_type</code>, attributes and <code>_children</code> if applicable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{_type: catalog, _children: [
  {_type: book, id: bk101, _children: [
    {_type: author, _text: Gambardella, Matthew},
    {_type: title, _text: XML Developer's Guide},
    {_type: genre, _text: Computer},
    {_type: price, _text: 44.95},
    {_type: publish_date, _text: 2000-10-01},
    {_type: description, _text: An in-depth look at creating applications ....</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_for_each_book_how_do_i_access_book_id">For each book, how do I access book id ?</h5>
<div class="paragraph">
<p>You can access attributes per element directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml") yield value as catalog
UNWIND catalog._children as book
RETURN book.id</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
book.id

bk101  

bk102  </pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_for_each_book_how_do_i_access_book_author_and_title">For each book, how do I access book author and title ?</h5>
<div class="sect5">
<h6 id="_filter_into_collection">Filter into collection</h6>
<div class="paragraph">
<p>You have to filter over the sub-elements  in the <code>_childrens</code> array in this case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml") yield value as catalog
UNWIND catalog._children as book
RETURN book.id, [attr IN book._children WHERE attr._type IN ['author','title'] | [attr._type, attr._text]] as pairs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
book.idpairs                                                                   

bk101  [[author, Gambardella, Matthew], [title, XML Developer's Guide]]        

bk102  [[author, Ralls, Kim], [title, Midnight Rain]]                          </pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_return_collection_elements">Return Collection Elements</h6>
<div class="paragraph">
<p>This is not too nice, we could also just have returned the values and then grabbed them out of the list, but that relies on element-order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml") yield value as catalog
UNWIND catalog._children as book
WITH book.id as id, [attr IN book._children WHERE attr._type IN ['author','title'] | attr._text] as pairs
RETURN id, pairs[0] as author, pairs[1] as title</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
id   author              title                         

bk101Gambardella, MatthewXML Developer's Guide         

bk102Ralls, Kim          Midnight Rain                 </pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_turn_pairs_into_map">Turn Pairs into Map</h6>
<div class="paragraph">
<p>So better is to turn them into a map with <code>apoc.map.fromPairs</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml") yield value as catalog
UNWIND catalog._children as book
WITH book.id as id, [attr IN book._children WHERE attr._type IN ['author','title'] | [attr._type, attr._text]] as pairs
CALL apoc.map.fromPairs(pairs) yield value
RETURN id, value</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
id   value                                                               

bk101{author: Gambardella, Matthew, title: XML Developer's Guide}        

bk102{author: Ralls, Kim, title: Midnight Rain}                          

bk103{author: Corets, Eva, title: Maeve Ascendant}                       </pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_return_individual_columns">Return individual Columns</h6>
<div class="paragraph">
<p>And now we can cleanly access the attributes from the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xml("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml") yield value as catalog
UNWIND catalog._children as book
WITH book.id as id, [attr IN book._children WHERE attr._type IN ['author','title'] | [attr._type, attr._text]] as pairs
CALL apoc.map.fromPairs(pairs) yield value
RETURN id, value.author, value.title</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
id   value.author        value.title                   

bk101Gambardella, MatthewXML Developer's Guide         

bk102Ralls, Kim          Midnight Rain                 

bk103Corets, Eva         Maeve Ascendant               </pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_simpler_xml_format">Simpler XML Format</h5>
<div class="paragraph">
<p>In a simpler XML representation, each type of children gets it&#8217;s own entry within the parent map.
The element-type as key is prefixed with "_" to prevent collisions with attributes.</p>
</div>
<div class="paragraph">
<p>If there is a single element, then the entry will just have that element as value.
If there is more than one element there will be a list of values.</p>
</div>
<div class="paragraph">
<p>Each child will still have its <code>_type</code> field to discern them.</p>
</div>
<div class="paragraph">
<p>Here is the example from above loaded with <code>apoc.load.xmlSimple</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.load.xmlSimple("https://raw.githubusercontent.com/neo4j-contrib/neo4j-apoc-procedures/master/src/test/resources/books.xml")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{_type: "catalog", _book: [
  {_type: "book", id: "bk101",
    _author: [{_type: "author", _text: "Gambardella, Matthew"},{_type: author, _text: "Arciniegas, Fabio"}],
    _title: {_type: "title", _text: "XML Developer's Guide"},
    _genre: {_type: "genre", _text: "Computer"},
    _price: {_type: "price", _text: "44.95"},
    _publish_date: {_type: "publish_date", _text: "2000-10-01"},
    _description: {_type: description, _text: An in-depth look at creating applications ....</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_refactorings">Graph Refactorings</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_graph_refactoring_procedures">Graph Refactoring Procedures</h3>
<div class="paragraph">
<p>These procedures help refactor the structure of your graph.
This is helpful when you need to change your data model or for cleaning up data that was imported from an external source.</p>
</div>
<div class="sect3">
<h4 id="_normalize_boolean_properties">Normalize boolean properties</h4>
<div class="paragraph">
<p>Given raw data boolean properties are often represented by placeholder values.
This procedure turns them into boolean properties.</p>
</div>
<div class="paragraph">
<p>Will be true if "Y", YES"; false if "N", "NO"; null otherwise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)
CALL apoc.refactor.normalizeAsBoolean(n, "prop", ["Y", "YES"], ["N", NO"])
RETURN n.prop</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_categorization">Categorization</h4>
<div class="paragraph">
<p>Categorize replaces string property values on nodes with relationship to a unique category node for that property value.</p>
</div>
<div class="paragraph">
<p>This example will turn all n.color properties into :HAS_ATTRIBUTE relationships to :Color nodes with a matching .colour property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL apoc.refactor.categorize('color','HAS_ATTRIBUTE',true,'Color','colour',['popularity'],1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, it will also copy over the first 'popularity' property value encountered on any node n for each newly created :Color node and remove any occurrences of that property value on nodes with the same 'Color'.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cypher_operations">Cypher Operations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_cypher_fragments">Running Cypher fragments</h3>
<div class="paragraph">
<p>We can use Cypher as safe, graph-aware, partially compiled scripting language within APOC.</p>
</div>
<div class="sect3">
<h4 id="_cypher_execution_2">Cypher Execution</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.run(fragment, params) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes reading fragment with the given parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runFile(file or url) yield row, result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">runs each statement in the file, all semicolon separated - currently no schema operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runMany('cypher;\nstatements;',{params})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">runs each semicolon separated statement and returns summary - currently no schema operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.mapParallel(fragment, params, list-to-parallelize) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes fragment in parallel batches with the list segments being assigned to _</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.doIt(fragment, params) yield value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executes writing fragment with the given parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL apoc.cypher.runTimeboxed('cypherStatement',{params}, timeout)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abort statement after timeout millis if not finished</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_example_fast_node_counts_by_label">Example: Fast Node-Counts by Label</h4>
<div class="paragraph">
<p>Counts by label are quickly provided by the counts-store, but only if they are the the single thing in the query, like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person) RETURN count(*);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It also works to combine several with <code>UNION ALL</code>, but not via <code>WITH</code></p>
</div>
<div class="listingblock">
<div class="title">Doesn&#8217;t work</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person) WITH count(*) as people
MATCH (:Movie) RETURN people, count(*) as movies;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Works</div>
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person) RETURN count(*)
UNION ALL
MATCH (:Movie) RETURN count(*);</code></pre>
</div>
</div>
<div class="paragraph">
<p>But with <code>apoc.cypher.run</code> we can construct the statement and run each of them individually, so it completes in a few ms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call db.labels() yield label
call apoc.cypher.run("match (:`"+label+"`) return count(*) as count", null) yield value
return label, value.count as count</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_a_cypher_statement_timeboxed">running a cypher statement timeboxed</h4>
<div class="paragraph">
<p>There&#8217;s a way to terminate a cypher statement if it takes longer than a given threshold. Consider an expensive statement calculating cross product of shortestpaths for each pair of nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.cypher.runTimeboxed("match (n),(m) match p=shortestPath((n)-[*]-(m)) return p", null, 10000) yield value
return value.p</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_job_management_and_periodic_execution">Job management and periodic execution</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
this document is work in progress
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">call apoc.periodic.commit("
match (u:User)
where not u:Processed
with u limit {limit}
SET u:Processed RETURN count(*)
",{limit:10000})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+=======+==========+
|updates|executions|
+=======+==========+
|2000000|200       |
+-------+----------+</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-08-18 22:56:07 MESZ
</div>
</div>
</body>
</html>